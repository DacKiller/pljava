#-------------------------------------------------------------------------
#
# Makefile--
#    Makefile for pljava
#
#-------------------------------------------------------------------------

include $(top_builddir)/src/Makefile.global

override CPPFLAGS := -DPKGLIBDIR=\"$(pkglibdir)\" -I$(incldir) $(CPPFLAGS)

# Don't use higher standard then c89 since this rules out older compilers. We
# must use 'long long' however, since JNI defines it.
#
override CFLAGS := -pedantic -std=c89 -Wno-long-long $(CFLAGS)

ifeq ($(PORTNAME), cygwin)
#
# Portname will not suffice. The Win32 JDK have no knowledge of cygwin
# GNU compiler doesn't know __int64, instead it uses long long.
#
ifeq ($(JAVA_HOME),)
	override CPPFLAGS := -DGCJ $(CPPFLAGS)
else
	override CPPFLAGS := -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/win32 $(CPPFLAGS)
endif
override CPPFLAGS := -DCYGWIN -D__int64='long long' $(CPPFLAGS)

else
#
# Don't know how to make the configure package recognize the
# jre/lib/<xxx> directory where <xxx> is the architecture.
# This is a cludge that should be moved elsewhere.
#
ifeq ($(host_cpu), i686)
	jre_cpu = i386
else
	jre_cpu = $(host_cpu)
endif

ifneq ($(JAVA_HOME),)
	override CPPFLAGS := -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/$(PORTNAME) $(CPPFLAGS)
endif
override LDFLAGS := -shared -L$(JAVA_HOME)/jre/lib/$(jre_cpu)/client -ljvm $(LDFLAGS)
override CFLAGS := -fpic $(CFLAGS)
endif
